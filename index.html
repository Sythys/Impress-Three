<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1920 height=1080" />
    <title>RootPresentation</title>
    <meta name="author" content="Joshua Best" />
    <link href="css/impress-demo.css" rel="stylesheet" />
</head>
<body id="background">
<div id="data" style="position: fixed; top: 10px; left: 10px;"></div>
<div id="impress" data-autoplay="0.5">

    <div class="step" data-x="0" data-y="0" data-z="0" data-scale="1" data-rotate-z="0"><p>*____________________</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-scale="2" data-rotate-z="0"><p>*____________________</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-scale="3" data-rotate-z="0"><p>*____________________</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-scale="4" data-rotate-z="0"><p>*____________________</p></div>

    <div class="step" data-x="500" data-y="0" data-z="0" data-scale="1" data-rotate-z="0"><p>*____________________</p></div>
    <div class="step" data-x="500" data-y="0" data-z="0" data-scale="1" data-rotate-z="90"><p>*____________________</p></div>
    <div class="step" data-x="500" data-y="0" data-z="0" data-scale="1" data-rotate-z="180"><p>*____________________</p></div>
    <div class="step" data-x="500" data-y="0" data-z="0" data-scale="1" data-rotate-z="270"><p>*____________________</p></div>

    <div class="step" data-x="0" data-y="0" data-z="500" data-scale="1" data-rotate-z="0"><p>*____________________</p></div>
    <div class="step" data-x="0" data-y="0" data-z="500" data-scale="1" data-rotate-z="90"><p>*____________________</p></div>
    <div class="step" data-x="0" data-y="0" data-z="500" data-scale="1" data-rotate-z="180"><p>*____________________</p></div>
    <div class="step" data-x="0" data-y="0" data-z="500" data-scale="1" data-rotate-z="270"><p>*____________________</p></div>

    <div class="step" data-x="500" data-y="0" data-z="500" data-scale="1" data-rotate-z="0"><p>*____________________</p></div>
    <div class="step" data-x="500" data-y="0" data-z="500" data-scale="1" data-rotate-z="90"><p>*____________________</p></div>
    <div class="step" data-x="500" data-y="0" data-z="500" data-scale="1" data-rotate-z="180"><p>*____________________</p></div>
    <div class="step" data-x="500" data-y="0" data-z="500" data-scale="1" data-rotate-z="270"><p>*____________________</p></div>

    <div class="step" data-x="0" data-y="0" data-z="0" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-rotate-y="22.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-rotate-y="45" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-rotate-y="67.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="0" data-z="0" data-rotate-y="90" data-scale="1"><p>*___</p></div>

    <div class="step" data-x="0" data-y="0" data-z="1000" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="-382" data-z="923" data-rotate-x="22.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="-707" data-z="707" data-rotate-x="45" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="-923" data-z="382" data-rotate-x="67.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="-1000" data-z="0" data-rotate-x="90" data-scale="1"><p>*___</p></div>

    <div class="step" data-x="1000" data-y="0" data-z="1000" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="923" data-y="-382" data-z="1000" data-rotate-z="-22.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="707" data-y="-707" data-z="1000" data-rotate-z="-45" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="382" data-y="-923" data-z="1000" data-rotate-z="-67.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="-1000" data-z="1000" data-rotate-z="-90" data-scale="1"><p>*___</p></div>

    <div class="step" data-x="1000" data-y="0" data-z="1000" data-rotate-y="45" data-rotate-x="50" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="923" data-y="-382" data-z="1000" data-rotate-y="45" data-rotate-x="50" data-rotate-z="-22.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="707" data-y="-707" data-z="1000" data-rotate-y="45" data-rotate-x="50" data-rotate-z="-45" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="382" data-y="-923" data-z="1000" data-rotate-y="45" data-rotate-x="50" data-rotate-z="-67.5" data-scale="1"><p>*___</p></div>
    <div class="step" data-x="0" data-y="-1000" data-z="1000" data-rotate-y="45" data-rotate-x="50" data-rotate-z="-90" data-scale="1"><p>*___</p></div>

    <div class="step" data-x="1000" data-y="-1000" data-z="1000" data-rotate-y="90" data-rotate-z="-45" data-scale="1"><p>*___</p></div>

</div>
<script type="text/javascript" src="js/impress.js"></script>
<script type="text/javascript">impress().init();</script>
<script type="text/javascript" src="three/three.js"></script>
<script src="three/jsutil/loaders/GLTFLoader.js"></script>
<script src="three/jsutil/WebGL.js"></script>
<script type="text/javascript">

    let background = document.getElementById("background");
    let renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.gammaOutput = true;
    renderer.gammaFactor = 2.2;
    background.appendChild(renderer.domElement);

    var path = 'three/textures/MilkyWay/';
    var format = '.jpg';
    var envMap = new THREE.CubeTextureLoader().load( [
        path + 'dark-s_px' + format, path + 'dark-s_nx' + format,
        path + 'dark-s_py' + format, path + 'dark-s_ny' + format,
        path + 'dark-s_pz' + format, path + 'dark-s_nz' + format
    ] );

    let scene = new THREE.Scene();
    // scene.background = new THREE.Color( 0x666666 );
    scene.background = envMap;

    camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, .01, 100 );
    camera.position.set( 0, 0, 0 );

    light = new THREE.HemisphereLight( 0xbbbbff, 0x444422 );
    light.position.set( 0, 1, 0 );
    scene.add( light );

    let loader = new THREE.GLTFLoader();
    loader.load( 'three/models/plane2.gltf', function ( gltf ) {
        gltf.scene.traverse( function ( child ) {
            if ( child.isMesh ) {
                child.material.envMap = envMap;
            }
        } );
        scene.add( gltf.scene );},undefined,undefined);

    let Step = true;
    let deltaA = Date.now();
    let stateA = currentState;

    function setCameraTranslation() {
        let stateB = currentState;
        let delta = null;
        let translationScale = 0.001;
        let deltaProgress = 1;
        let state = [0,0,4,0,0,0,0];
        delta = Date.now();
        stateB = currentState;
        // Step = false;
        if((stateA !== stateB) && (Step)) {
            deltaA = Date.now() - 19;
            Step = false;
        }
        deltaProgress = ((delta-deltaA)/GlobalDuration);
        if(deltaProgress >= 1){
            deltaProgress = 1;
        }

        if(deltaProgress >= 1){
            stateA = stateB;
            Step = true;
        }
        deltaProgress = ( 3 * Math.pow(deltaProgress,2) ) - ( 2 * Math.pow(deltaProgress,3) );
        // deltaProgress = ( 1.26 * deltaProgress ) - ( 0.78 * Math.pow(deltaProgress,2) ) + ( 0.52 * Math.pow(deltaProgress,3) );

        state[3] = stateA.rotate.x + (( stateB.rotate.x - stateA.rotate.x ) * deltaProgress);
        state[4] = stateA.rotate.y + (( stateB.rotate.y - stateA.rotate.y ) * deltaProgress);
        state[5] = stateA.rotate.z + (( stateB.rotate.z - stateA.rotate.z ) * deltaProgress);

        state[0] = stateA.translate.x + (( stateB.translate.x - stateA.translate.x ) * deltaProgress);
        state[1] = stateA.translate.y + (( stateB.translate.y - stateA.translate.y ) * deltaProgress);
        state[2] = stateA.translate.z + (( stateB.translate.z - stateA.translate.z ) * deltaProgress);

        state[0] -= (-1.29)*(Math.sin(state[4]*Math.PI/180))*(1/(stateA.scale + ( stateB.scale - stateA.scale )* deltaProgress))/translationScale;
        state[1] += (-1.29)*(Math.sin(state[3]*Math.PI/180))*(1/(stateA.scale + ( stateB.scale - stateA.scale )* deltaProgress))/translationScale;
        state[2] += (-1.29)*(Math.cos(state[3]*Math.PI/180)*Math.cos(state[4]*Math.PI/180))*(1/(stateA.scale + ( stateB.scale - stateA.scale )* deltaProgress))/translationScale;

        camera.position.set(state[0]*(-1)*translationScale,state[1]*translationScale,state[2]*(-1)*translationScale);
        camera.rotation.set(state[3]*Math.PI/180, state[4]*(-1)*Math.PI/180,state[5]*Math.PI/180);

        function printData() {
            let node = document.getElementById("data");
            node.innerHTML = '<h1 style="font-family: Consolas;color: white;">' + "</br>"
                + camera.position.x.toFixed(2) + " = " + state[0] + " = " + currentState.translate.x.toFixed(2) + " " + stateA.translate.x + " " + stateB.translate.x + "</br>"
                + camera.position.y.toFixed(2) + " = " + state[1] + " = " + currentState.translate.y.toFixed(2) + "</br>"
                + camera.position.z.toFixed(2) + " = " + state[2] + " = " + currentState.translate.z.toFixed(2) + "</br>"
                + camera.rotation.x.toFixed(2) + " = " + state[3] + " = " + currentState.rotate.x.toFixed(2) + "</br>"
                + camera.rotation.y.toFixed(2) + " = " + state[4] + " = " + currentState.rotate.y.toFixed(2) + "</br>"
                + camera.rotation.z.toFixed(2) + " = " + state[5] + " = " + currentState.rotate.z.toFixed(2) + "</br>"
                + "DeltaProgress__" + deltaProgress.toFixed(2) + "</br>"
                + "DeltaA_________" + deltaA + "</br>"
                + "delta__________" + delta + "</br>"
                + "Step___________" + Step + "</br>"
                + "Test___________" + ((delta-deltaA)/GlobalDuration).toFixed(2) + "</br>"
                + "GlobalDuration_" + GlobalDuration + "</h1>";
        }
        printData()
    }

    function animate() {
        requestAnimationFrame( animate );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.render( scene, camera );
        setCameraTranslation();
    }
    animate();
</script>
</body>
</html>
